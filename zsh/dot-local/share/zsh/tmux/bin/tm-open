#!/usr/bin/env bash
# tm-open
#   create new or switch to existing sessiong

selected_dir=$1

if [[ -z $selected_dir ]]; then
    echo "Usage: tm-open <path>"
    exit 1
fi

selected_name=$(basename "$selected_dir" | tr . _)

tmux has-session -t=$selected_name 2>/dev/null

if [ $? != 0 ]; then
		if [[ -f "$selected_dir/.sboxrc" ]]; then
			tmux new-session -d \
				-s "$selected_name"        \
        -c "$selected_dir"    \
				"(source $selected_dir/.sboxrc && launch)"
		else
        tmux new-session -ds $selected_name -c $selected_dir tm-launch
		fi
fi

if [[ -z $TMUX ]]; then
    tmux attach-session -t=$selected_name
else
    tmux switch-client -t=$selected_name
fi
