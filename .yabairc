#!/usr/bin/env bash
source $HOME/.config/sketchybar/vars.sh

sudo yabai --load-sa

yabai -m signal --add event=dock_did_restart action="sudo yabai --load-sa"
yabai -m signal --add event=window_focused action="sketchybar --trigger window_focus"
yabai -m signal --add event=display_added action="sleep 1 && $HOME/.config/yabai/create_spaces.sh"
yabai -m signal --add event=display_removed action="sleep 1 && $HOME/.config/yabai/create_spaces.sh"
yabai -m signal --add event=window_created action="sketchybar --trigger windows_on_spaces"
yabai -m signal --add event=window_destroyed action="sketchybar --trigger windows_on_spaces"

yabai -m config                            \
  top_padding                32            \
  bottom_padding             32            \
  left_padding               32            \
  right_padding              32            \
                                           \
  window_gap                 32            \
  window_topmost             off           \
  window_border              on            \
  window_border_width        4             \
  window_border_radius       10            \
  window_placement           second_child  \
  window_opacity             off           \
  active_window_border_color $COLOR_ACTIVE \
  normal_window_border_color $BLACK        \
                                           \
  insert_feedback_color      $COLOR_INFO   \
  mouse_modifier             ctrl          \
  mouse_action1              move          \
  mouse_action2              resize        \
  mouse_follows_focus        off           \
  focus_follows_mouse        off           \
                                           \
  split_type                 auto          \
  auto_balance               off           \
  layout                     bsp           \
  external_bar               main:32:0

yabai -m space 1 --layout bsp   --label side
yabai -m space 2 --layout bsp   --label main
yabai -m space 3 --layout bsp   --label comm
yabai -m space 4 --layout bsp   --label plan
yabai -m space 5 --layout float --label play
yabai -m space 6 --layout float --label chat
yabai -m space 7 --layout bsp
yabai -m space 8 --layout bsp
yabai -m space 9 --layout bsp

yabai -m rule --add app="^Finder$" title="(Co(py|nnect)|Move|Info|Pref)" manage=off
yabai -m rule --add app="^Safari$" title="^(General|(Tab|Password|Website|Extension)s|AutoFill|Se(arch|curity)|Privacy|Advance)$" manage=off
yabai -m rule --add app="^System Preferences$" title=".*" manage=off
yabai -m rule --add title='Preferences$' manage=off
yabai -m rule --add app="^App Store$" manage=off
yabai -m rule --add app="^Activity Monitor$" manage=off
yabai -m rule --add app="^Dictionary$" manage=off
yabai -m rule --add app="^Dash$" manage=off
yabai -m rule --add app="^Telephone$" manage=off
yabai -m rule --add app="^Hammerspoon Console$" manage=off
yabai -m rule --add title="Software Update" manage=off
yabai -m rule --add title="Cursor Pro" manage=off
yabai -m rule --add app="System Information" title="About This Mac" manage=off
yabai -m rule --add app="Microsoft Teams" space=comm
yabai -m rule --add title="Microsoft Teams Notifications" space=comm manage=off
yabai -m rule --add app="MailMate" space=comm
yabai -m rule --add app="Discord" space= grid=2:1:0:0:1:1 manage=off
yabai -m rule --add app="^(Calculator|System Preferences|Archive Utility)$" manage=off

printf "yabai: configuration loaded...\\n"
