#!/usr/bin/env zsh
export NOX_ACTIONS_ROOT="$HOME/.local/share/nox-menu"
export NOX_CACHE_ROOT="$HOME/.cache/nox-menu"

pick() {
    fd | fuzzel --dmenu --cache "/tmp/nox-menu-cache"
}

run() {
    if [[ -d "$1" ]]; then
	cd "$1"
	exec nox-menu
    fi

    if [[ -x "$1" ]]; then
	exec "$1" "${@:2}"
    fi

    notify-send -u urgent "nox-menu" "Error: $1 is neither executable nor directory"
    exit 1
}

# make sure we're in a subdirectory of the actions root
if [[ $(pwd) != $NOX_ACTIONS_ROOT* ]]; then
    cd $NOX_ACTIONS_ROOT
fi

action="${1-$(pick)}" || exit 0
exec run "$action" "${@:2}"
